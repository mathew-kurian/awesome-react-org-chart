!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="./spec/spec.ts")}({"./lib/core/Box.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var o=i("./lib/core/Size.ts");class n{get IsDataBound(){return!!this.DataId}static Special(t,e,i){return new n(null,t,e,!0,i,!1)}constructor(t,e,i,n,r,a){if(0==e)throw new Error("Invalid "+e);this.Id=e,this.ParentId=i,this.DataId=t,this.IsSpecial=n,this.IsAssistant=a,this.DisableCollisionDetection=r,this.AssistantLayoutStrategyId=null,this.LayoutStrategyId=null,this.IsCollapsed=!1,this.Size=new o.a(0,0)}}n.None=-1},"./lib/core/BoxContainer.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var o=i("./lib/core/Box.ts");class n{constructor(t){this._lastBoxId=0,this._boxesById=new Map,this._boxesByDataId=new Map,this.SystemRoot=null,t&&this.ReloadBoxes(t)}get BoxesById(){return this._boxesById}get BoxesByDataId(){return this._boxesByDataId}ReloadBoxes(t){this._boxesByDataId.clear(),this._boxesById.clear(),this._lastBoxId=0,this.SystemRoot=o.a.Special(++this._lastBoxId,o.a.None,!0),this._boxesById.set(this.SystemRoot.Id,this.SystemRoot);const e=new Map;for(const i of t.AllDataItemIds)e.set(i,this.NextBoxId());const i=t.GetDataItemFunc;for(const o of t.AllDataItemIds){const n=o?t.GetParentKeyFunc(o):null,r=n?e.get(n):this.SystemRoot.Id,a=e.get(o);null!=a&&null!=r&&this._AddBox(o,a,r,i(o).IsAssistant)}}AddBox(t,e,i){return this._AddBox(t,this.NextBoxId(),e,i)}_AddBox(t,e,i,n){const r=new o.a(t,e,i,!1,!1,n);return this._boxesById.set(r.Id,r),r.DataId&&this._boxesByDataId.set(r.DataId,r),r}NextBoxId(){return this._lastBoxId++,this._lastBoxId}}},"./lib/core/BranchParentAlignment.ts":function(t,e,i){"use strict";var o,n;(n=o||(o={}))[n.InvalidValue=0]="InvalidValue",n[n.Left=1]="Left",n[n.Center=2]="Center",n[n.Right=3]="Right",e.a=o},"./lib/core/Connector.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));class o{constructor(t){if(0==t.length)throw new Error("Need at least one segment");this.Segments=t}}},"./lib/core/Diagram.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class o{constructor(){this._branchSpacing=0,this.DefaultAssistantLayoutStrategyId=null,this.DefaultLayoutStrategyId=null,this.BranchSpacing=50,this.LayoutStrategies=new Map}get BranchSpacing(){return this._branchSpacing}set BranchSpacing(t){if(t<0)throw new Error("Cannot be negative");this._branchSpacing=t}RequireDefaultLayoutStrategy(){const t=this.DefaultLayoutStrategyId;if(!t)throw new Error("DefaultLayoutStrategyId is null or not valid");const e=this.LayoutStrategies.get(t);if(!e)throw new Error("DefaultLayoutStrategyId is null or not valid");return e}RequireDefaultAssistantLayoutStrategy(){const t=this.DefaultAssistantLayoutStrategyId;if(!t)throw new Error("DefaultLayoutStrategyId is null or not valid");const e=this.LayoutStrategies.get(t);if(!e)throw new Error("DefaultLayoutStrategyId is null or not valid");return e}}class n{constructor(){this._visualTree=null,this._boxes=null,this.LayoutSettings=new o}get Boxes(){if(null==this._boxes)throw Error("Boxes is null");return this._boxes}set Boxes(t){this._visualTree=null,this._boxes=t}get VisualTree(){return this._visualTree}set VisualTree(t){this._visualTree=t}}},"./lib/core/Dimensions.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));class o{static MinMax(){return new o(Number.MAX_VALUE,Number.MIN_VALUE)}constructor(t,e){this.From=t,this.To=e}static add(t,e){return new o(Math.min(t.From,e.From),Math.max(t.To,e.To))}}},"./lib/core/Edge.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));class o{constructor(t,e){this.From=t,this.To=e}}},"./lib/core/FishboneAssistantsLayoutStrategy.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return S}));var o=i("./lib/core/LayoutStrategyBase.ts"),n=i("./lib/core/Box.ts"),r=i("./lib/core/Dimensions.ts"),a=i("./lib/core/LayoutAlgorithm.ts"),s=i("./lib/core/Rect.ts"),l=i("./lib/core/Edge.ts"),h=i("./lib/core/Point.ts"),u=i("./lib/core/Connector.ts");class S extends o.a{constructor(){super(...arguments),this.GetSupportsAssistants=()=>!1,this.MaxOnLeft=t=>Math.floor(t.State.NumberOfSiblings/2)+t.State.NumberOfSiblings%2,this.NeedCarrierProtector=t=>{var e;return 0==(null==(e=t.ParentNode)?void 0:e.ChildCount)}}PreProcessThisNode(t,e){if(e.State.NumberOfSiblings=e.ChildCount,e.State.NumberOfSiblings>0){e.State.NumberOfSiblingColumns=1,e.State.NumberOfSiblingRows=Math.floor(e.State.NumberOfSiblings/2),e.State.NumberOfSiblings%2!=0&&e.State.NumberOfSiblingRows++;var i=n.a.Special(n.a.None,e.Element.Id,!1);e.AddRegularChildBox(i)}}ApplyVerticalLayout(t,e){const i=e.BranchRoot;if(0==i.Level)throw new Error("Should never be invoked on root node");if(null==i.State.SiblingsRowV)throw Error("SiblingsRowV is null");let o=i.State.SiblingsRowV.To;const n=this.MaxOnLeft(i);for(var l=0;l<n;l++){const e=0==l?this.ParentChildSpacing:this.SiblingSpacing,h=i.Children[l],u=h.State;a.a.MoveTo(u,u.Left,o+e);let S=new r.a(u.Top,u.Bottom);const c=l+n;if(null==u.Size)throw Error("Size is null");if(c<i.State.NumberOfSiblings){const n=i.Children[c],l=n.State;if(a.a.MoveTo(l,l.Left,o+e),null==l.Size)throw Error("Size is null");l.Bottom>u.Bottom?a.a.MoveTo(u,u.Left,l.CenterV-u.Size.Height/2):l.Bottom<u.Bottom&&a.a.MoveTo(l,l.Left,u.CenterV-l.Size.Height/2),l.BranchExterior=s.a.from(l.Size,l.TopLeft),S=r.a.add(S,new r.a(l.Top,l.Bottom)),l.SiblingsRowV=S,a.a.VerticalLayout(t,n),o=l.BranchExterior.Bottom}u.BranchExterior=s.a.from(u.Size,u.TopLeft),u.SiblingsRowV=S,a.a.VerticalLayout(t,h),o=Math.max(o,u.BranchExterior.Bottom)}}ApplyHorizontalLayout(t,e){var i=e.BranchRoot;0==i.Level&&(i.State.SiblingsRowV=new r.a(i.State.Top,i.State.Bottom));for(var o=!0,n=0,s=this.MaxOnLeft(i),l=0;l<i.State.NumberOfSiblings;l++){var h=i.Children[l];if(a.a.HorizontalLayout(t,h),++n==s&&o){a.a.AlignHorizontalCenters(t,e,this.EnumerateSiblings(i,0,s)),o=!1,n=0;for(var u=Number.MIN_VALUE,S=0;S<=l;S++)u=Math.max(u,i.Children[S].State.BranchExterior.Right);if(i.State.NumberOfSiblings%2!=0)u=Math.max(u,h.State.Right);else{var c=i.Children[i.State.NumberOfSiblings-1];u=c.Element.IsCollapsed||0==c.ChildCount?Math.max(u,h.State.Right):Math.max(u,h.State.BranchExterior.Right)}const r=i.Children[i.State.NumberOfSiblings];a.a.AdjustSpacer(r.State,u,i.State.Bottom,this.ParentConnectorShield,i.State.BranchExterior.Bottom-i.State.Bottom),e.Boundary.MergeFromNode(r)}}if(a.a.AlignHorizontalCenters(t,e,this.EnumerateSiblings(i,s,i.State.NumberOfSiblings)),i.Level>0&&i.State.NumberOfSiblings>0){let o=i.Children[i.State.NumberOfSiblings].State.CenterH;const n=i.State.CenterH-o;a.a.MoveChildrenOnly(t,e,n)}}RouteConnectors(t,e){var i=e.State.NumberOfSiblings;if(0!=i){this.NeedCarrierProtector(e)&&i++;for(var o=[],n=0,r=this.MaxOnLeft(e),a=e.Children[e.State.NumberOfSiblings].State,s=a.CenterH,S=!0,c=0,d=Number.MIN_VALUE,g=0;g<e.State.NumberOfSiblings;g++){var f=S?e.Children[g].State.Right:e.Children[g].State.Left,m=e.Children[g].State.CenterV;d=Math.max(d,m),o[n++]=new l.a(new h.a(s,m),new h.a(f,m)),++c==r&&(c=0,S=!S)}this.NeedCarrierProtector(e)&&(o[e.State.NumberOfSiblings]=new l.a(new h.a(a.CenterH,a.Top),new h.a(a.CenterH,d))),e.State.Connector=new u.a(o)}}EnumerateSiblings(t,e,i){const o=[];for(var n=e;n<i;n++)o.push(t.Children[n]);return o}}},"./lib/core/LayoutAlgorithm.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var o=i("./lib/core/Rect.ts"),n=i("./lib/core/Box.ts"),r=i("./lib/core/Node.ts");class a{constructor(){this.Depth=0,this.Root=null,this.Nodes=new Map}IterateChildFirst(t){if(null==this.Root)throw Error("Root is null");return this.Root.IterateChildFirst(t)}IterateParentFirst(t,e){if(null==this.Root)throw Error("Root is null");this.Root.IterateParentFirst(t,e)}UpdateHierarchyStats(){this.Depth=0,this.IterateParentFirst(t=>(null!=t.ParentNode?(t.Level=t.ParentNode.Level,t.ParentNode.IsAssistantRoot||(t.Level=t.Level+1),this.Depth=Math.max(1+t.Level,this.Depth)):(t.Level=0,this.Depth=1),!0))}static Build(t){const e=new a;let i;for(i of t.Diagram.Boxes.BoxesById.values()){const t=new r.a(i);e.Nodes.set(i.Id,t)}for(const t of e.Nodes.values()){const i=t.Element.ParentId,o=e.Nodes.get(i);if(o)t.Element.IsAssistant&&o.Element.ParentId!=n.a.None?o.AddAssistantChild(t):o.AddRegularChild(t);else{if(null!=e.Root)throw new Error("InvalidOperationException: More then one root found: "+t.Element.Id);e.Root=t}}return e}}var s=i("./lib/core/Operation.ts"),l=i("./lib/core/Point.ts"),h=i("./lib/core/Dimensions.ts"),u=i("./lib/core/Size.ts"),S=i("./lib/core/Utils.ts");class c{static ComputeBranchVisualBoundingRect(t){let e=new o.a(0,0,0,0),i=!1;if(null==t.Root)throw Error("Root is null");return t.Root.IterateParentFirst(t=>{var n=t.Element;if(!t.State.IsHidden&&!n.IsSpecial){if(null==t.State.Size)throw Error("Size is null");if(null==t.State.TopLeft)throw Error("TopLeft is null");i?e=o.a.add(e,o.a.from(t.State.Size,t.State.TopLeft)):(i=!0,e=o.a.from(t.State.Size,t.State.TopLeft))}return!n.IsCollapsed}),e}static Apply(t){var e,i;if(t.Diagram.Boxes&&null==t.Diagram.Boxes.SystemRoot)throw new Error("SystemRoot is not initialized on the box container");t.CurrentOperation=s.a.Preparing;var n=a.Build(t);if(t.Diagram.VisualTree=n,null==n.Root||t.Diagram.Boxes&&n.Root.Element.Id!=(null==(e=t.Diagram.Boxes.SystemRoot)?void 0:e.Id))throw new Error("SystemRoot is not on the top of the visual tree");if(n.UpdateHierarchyStats(),t.AttachVisualTree(n),n.IterateParentFirst(t=>(t.State.IsHidden=null!=t.ParentNode&&(t.ParentNode.State.IsHidden||t.ParentNode.Element.IsCollapsed),!0)),t.CurrentOperation=s.a.PreprocessVisualTree,null!=t.BoxSizeFunc)for(const e of[...null==(i=t.Diagram.Boxes)?void 0:i.BoxesById.values()].filter(t=>t.IsDataBound))e.Size=t.BoxSizeFunc(e.DataId);for(const e of t.Diagram.Boxes.BoxesById.values())this.AssertBoxSize(e);n.IterateParentFirst(t=>(c.MoveTo(t.State,0,0),t.State.Size=t.Element.Size,t.State.BranchExterior=o.a.from(t.Element.Size,new l.a(0,0)),!0)),this.PreprocessVisualTree(t,n),n.UpdateHierarchyStats(),t.CurrentOperation=s.a.VerticalLayout,this.VerticalLayout(t,n.Root),t.CurrentOperation=s.a.HorizontalLayout,this.HorizontalLayout(t,n.Root),t.CurrentOperation=s.a.ConnectorsLayout,this.RouteConnectors(t,n),t.CurrentOperation=s.a.Completed}static AssertBoxSize(t){if(!(t.Size.Width>=0&&t.Size.Width<=1e9&&t.Size.Height>=0&&t.Size.Width<=1e9))throw new Error(`Box ${t.Id} has invalid size: ${t.Size.Width}x${t.Size.Height}`)}static PreprocessVisualTree(t,e){const i=t.Diagram.LayoutSettings.RequireDefaultLayoutStrategy(),o=t.Diagram.LayoutSettings.RequireDefaultAssistantLayoutStrategy(),n=[];n.push(i);const r=[];r.push(o),e.IterateParentFirst(e=>{var i;if(e.State.IsHidden)return!1;let o=null;if(null!=t.LayoutOptimizerFunc){var a=t.LayoutOptimizerFunc(e);a&&(o=t.Diagram.LayoutSettings.LayoutStrategies.get(a))}if(e.IsAssistantRoot){if(null==o&&(o=null!=(null==(i=e.ParentNode)?void 0:i.Element.AssistantLayoutStrategyId)?t.Diagram.LayoutSettings.LayoutStrategies.get(e.ParentNode.Element.AssistantLayoutStrategyId):Object(S.a)(r)),null==o)throw Error("Strategy is null. Maybe it allows null?");r.push(o)}else{if(null==o&&(o=null!=e.Element.LayoutStrategyId?t.Diagram.LayoutSettings.LayoutStrategies.get(e.Element.LayoutStrategyId):Object(S.a)(n)),null==o)throw Error("Strategy is null. Maybe it allows null?");n.push(o),o.SupportsAssistants||e.SuppressAssistants()}return e.State.EffectiveLayoutStrategy=o,e.State.RequireLayoutStrategy.PreProcessThisNode(t,e),!e.Element.IsCollapsed&&e.ChildCount>0||null!=e.AssistantsRoot},t=>{t.State.IsHidden||(t.IsAssistantRoot?r.pop():n.pop())})}static HorizontalLayout(t,e){if(e.State.IsHidden)throw new Error(`Branch root ${e.Element.Id} does not affect layout`);let i=t.PushLayoutLevel(e);try{(0==e.Level||(e.State.NumberOfSiblings>0||null!=e.AssistantsRoot)&&!e.Element.IsCollapsed)&&e.State.RequireLayoutStrategy.ApplyHorizontalLayout(t,i)}finally{t.PopLayoutLevel()}}static VerticalLayout(t,e){if(e.State.IsHidden)throw new Error(`Branch root ${e.Element.Id} does not affect layout`);var i=t.PushLayoutLevel(e);try{(0==e.Level||(e.State.NumberOfSiblings>0||null!=e.AssistantsRoot)&&!e.Element.IsCollapsed)&&e.State.RequireLayoutStrategy.ApplyVerticalLayout(t,i)}finally{t.PopLayoutLevel()}}static RouteConnectors(t,e){e.IterateParentFirst(e=>!(e.Element.IsCollapsed||0==e.State.NumberOfSiblings&&null==e.AssistantsRoot)&&(0==e.Level||!(e.Element.IsSpecial&&!e.IsAssistantRoot)&&(e.State.RequireLayoutStrategy.RouteConnectors(t,e),!0)))}static MoveChildrenOnly(t,e,i){const o=e.BranchRoot.Children;if(null==o||0==o.length)throw new Error("Should never be invoked when children not set");const n=t=>{if(!t.State.IsHidden)try{t.State.TopLeft=t.State.TopLeft.MoveH(i),t.State.BranchExterior=t.State.BranchExterior.MoveH(i)}catch(t){}return!0};for(const t of o)t.IterateChildFirst(n);e.Boundary.ReloadFromBranch(e.BranchRoot),e.BranchRoot.State.BranchExterior=e.Boundary.BoundingRect}static MoveOneChild(t,e,i){e.IterateChildFirst(t=>(t.State.IsHidden||(t.State.TopLeft=t.State.TopLeft.MoveH(i),t.State.BranchExterior=t.State.BranchExterior.MoveH(i)),!0))}static MoveBranch(t,e,i){this.MoveOneChild(t,e.BranchRoot,i),e.Boundary.ReloadFromBranch(e.BranchRoot),e.BranchRoot.State.BranchExterior=e.Boundary.BoundingRect}static AlignHorizontalCenters(t,e,i){let o=Number.MIN_VALUE;for(const t of i){var n=t.State.CenterH;n>o&&(o=n)}let r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const e of i){const i=e.State.CenterH;if(i!==o){const n=o-i;this.MoveOneChild(t,e,n)}r=Math.min(r,e.State.BranchExterior.Left),a=Math.max(a,e.State.BranchExterior.Right)}return e.Boundary.ReloadFromBranch(e.BranchRoot),new h.a(r,a)}static CopyExteriorFrom(t,e){t.TopLeft=e.TopLeft,t.Size=e.Size,t.BranchExterior=e.BranchExterior,t.SiblingsRowV=e.SiblingsRowV}static IsMinValue(t){return t<=Number.MIN_VALUE+Number.EPSILON}static IsMaxValue(t){return t>=Number.MAX_VALUE-Number.EPSILON}static IsZero(t){return t<=Number.EPSILON&&t>=-Number.EPSILON}static IsEqual(t,e){return Math.abs(t-e)<=Number.EPSILON}static MoveTo(t,e,i){t.TopLeft=new l.a(e,i)}static AdjustSpacer(t,e,i,n,r){t.TopLeft=new l.a(e,i),t.Size=new u.a(n,r),t.BranchExterior=new o.a(e,i,n,r)}}},"./lib/core/LayoutState.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var o=i("./lib/core/Operation.ts");class n{constructor(t){this.State=t,this.CurrentOperation=t.CurrentOperation}}class r{constructor(t,e,i,o){this.Node=t,this.X=e,this.Top=i,this.Bottom=o}ChangeTop(t){return new r(this.Node,this.X,t,this.Bottom)}ChangeBottom(t){return new r(this.Node,this.X,this.Top,t)}ChangeOwner(t,e){return new r(t,e,this.Top,this.Bottom)}ChangeX(t){return new r(this.Node,t,this.Top,this.Bottom)}}var a=i("./lib/core/Rect.ts"),s=i("./lib/core/Size.ts"),l=i("./lib/core/Point.ts"),h=i("./lib/core/LayoutAlgorithm.ts");class u{constructor(t=!0){this._spacerMerger=null,this._boundingRect=null,this.Left=[],this.Right=[],t&&(this._spacerMerger=new u(!1))}get BoundingRect(){if(null==this._boundingRect)throw Error("BoundingRect is null");return this._boundingRect}set BoundingRect(t){this._boundingRect=t}PrepareForHorizontalLayout(t){if(this.Prepare(t),!t.Element.DisableCollisionDetection){var e=t.State;this.Left.push(new r(t,e.Left,e.Top,e.Bottom)),this.Right.push(new r(t,e.Right,e.Top,e.Bottom))}}Prepare(t){this.Left.length=0,this.Right.length=0,this.BoundingRect=a.a.from(t.State.Size,t.State.TopLeft)}VerticalMergeFrom(t){this.BoundingRect=a.a.add(this.BoundingRect,t.BoundingRect)}MergeFrom(t){if(t.BoundingRect.Top>=t.BoundingRect.Bottom)throw new Error("Cannot merge boundary of height "+(t.BoundingRect.Bottom-t.BoundingRect.Top));let e="r";for(;"\0"!=e;){let o="r"==e?this.Right:this.Left,n="r"==e?t.Right:t.Left,a=0,s=0;for(;s<n.length&&a<o.length;){let t=o[a],l=n[s];if(t.Bottom<=l.Top)a++;else if(l.Bottom<=t.Top)o[a]=l,s++,this.ValidateState();else{var i="r"==e?t.X<=l.X:t.X>=l.X;h.a.IsEqual(t.Top,l.Top)?h.a.IsEqual(t.Bottom,l.Bottom)?(i&&(o[a]=l),a++,s++,this.ValidateState()):t.Bottom<l.Bottom?(i&&(o[a]=t.ChangeOwner(l.Node,l.X)),n[s]=l.ChangeTop(t.Bottom),a++,this.ValidateState()):(i&&(o[a]=t.ChangeTop(l.Bottom),o.splice(a,0,l),a++),s++,this.ValidateState()):h.a.IsEqual(t.Bottom,l.Bottom)?t.Top<l.Top?(i&&(o[a]=t.ChangeBottom(l.Top),o.splice(a+1,0,l),a++),a++,s++,this.ValidateState()):(i?o[a]=l:(o.splice(a,0,l.ChangeBottom(t.Top)),a++),a++,s++,this.ValidateState()):t.Top<l.Top&&t.Bottom<l.Bottom?(i&&(o[a]=t.ChangeBottom(l.Top),o.splice(a+1,0,new r(l.Node,l.X,l.Top,t.Bottom)),a++),n[s]=l.ChangeTop(t.Bottom),a++,this.ValidateState()):t.Top<l.Top&&t.Bottom>l.Bottom?(i&&(o[a]=t.ChangeBottom(l.Top),o.splice(a+1,0,l),o.splice(a+2,0,t.ChangeTop(l.Bottom)),a+=2),s++,this.ValidateState()):t.Bottom>l.Bottom?(i?(o[a]=t.ChangeTop(l.Bottom),o.splice(a,0,l)):o.splice(a,0,l.ChangeBottom(t.Top)),a++,s++,this.ValidateState()):(i?o[a]=l.ChangeBottom(t.Bottom):(o.splice(a,0,l.ChangeBottom(t.Top)),a++),n[s]=l.ChangeTop(t.Bottom),a++,this.ValidateState())}}if(a==o.length)for(;s<n.length;)o.push(n[s]),s++,this.ValidateState();e="r"==e?"l":"\0"}this.BoundingRect=a.a.add(this.BoundingRect,t.BoundingRect)}ValidateState(){for(var t=1;t<this.Left.length;t++)if(this.Left[t].Top==this.Left[t].Bottom||this.Left[t].Top<this.Left[t-1].Bottom||this.Left[t].Top<=this.Left[t-1].Top||this.Left[t].Bottom<=this.Left[t].Top||this.Left[t].Bottom<=this.Left[t-1].Bottom)throw new Error("State error at Left index "+t);for(t=1;t<this.Right.length;t++)if(this.Right[t].Top==this.Right[t].Bottom||this.Right[t].Top<this.Right[t-1].Bottom||this.Right[t].Top<=this.Right[t-1].Top||this.Right[t].Bottom<=this.Right[t].Top||this.Right[t].Bottom<=this.Right[t-1].Bottom)throw new Error("State error at Right index "+t)}MergeFromNode(t){if(!t.Element.DisableCollisionDetection&&t.State.Size&&!h.a.IsZero(t.State.Size.Height)){if(null==this._spacerMerger)throw Error("SpaceMerger is null");this._spacerMerger.PrepareForHorizontalLayout(t),this.MergeFrom(this._spacerMerger)}}ComputeOverlap(t,e,i){let o=0,n=0,r=0;for(;o<this.Right.length&&n<t.Left.length;){let l=this.Right[o],h=t.Left[n];if(l.Bottom<=h.Top)o++;else if(h.Bottom<=l.Top)n++;else{if(!l.Node.Element.DisableCollisionDetection&&!h.Node.Element.DisableCollisionDetection){var a=l.Node.Element.IsSpecial||h.Node.Element.IsSpecial?0:l.Node.Element.ParentId==h.Node.Element.ParentId?e:i,s=l.X+a-h.X;s>r&&(r=s)}l.Bottom>=h.Bottom&&n++,h.Bottom>=l.Bottom&&o++}}return r}ReloadFromBranch(t){for(var e=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0;o<this.Left.length;o++){var n=this.Left[o],r=n.Node.State.Left;this.Left[o]=n.ChangeX(r),e=Math.min(e,r)}for(o=0;o<this.Right.length;o++){var h=this.Right[o],u=h.Node.State.Right;this.Right[o]=h.ChangeX(u),i=Math.max(i,u)}e=Math.min(t.State.Left,e),i=Math.max(t.State.Right,i),this.BoundingRect=a.a.from(new s.a(i-e,this.BoundingRect.Size.Height),new l.a(e,this.BoundingRect.Top))}}class S{constructor(t,e){this.BranchRoot=t,this.Boundary=e}}class c{constructor(t,e,i){this.Boundary=t,this.LayoutLevel=e,this.State=i}}var d=i("./lib/core/Utils.ts");class g{constructor(t){this._currentOperation=o.a.Idle,this._layoutStack=[],this._pooledBoundaries=[],this.BoxSizeFunc=null,this.LayoutOptimizerFunc=null,this.BoundaryChanged=null,this.OperationChanged=null,this.Diagram=t}get CurrentOperation(){return this._currentOperation}set CurrentOperation(t){this._currentOperation=t,this.OperationChanged&&this.OperationChanged(this,new n(this))}AttachVisualTree(t){for(;this._pooledBoundaries.length<t.Depth;)this._pooledBoundaries.push(new u)}PushLayoutLevel(t){0==this._pooledBoundaries.length&&this._pooledBoundaries.push(new u);const e=this._pooledBoundaries.pop();switch(this.CurrentOperation){case o.a.VerticalLayout:null==e||e.Prepare(t);break;case o.a.HorizontalLayout:null==e||e.PrepareForHorizontalLayout(t);break;default:throw new Error("This operation can only be invoked when performing vertical or horizontal layouts")}if(null==e)throw Error("Boundary cannot be null");var i=new S(t,e);return this._layoutStack.push(i),this.BoundaryChanged&&this.BoundaryChanged(this,new c(e,i,this)),i}MergeSpacer(t){if(this.CurrentOperation!=o.a.HorizontalLayout)throw new Error("Spacers can only be merged during horizontal layout");if(0==this._layoutStack.length)throw new Error("Cannot merge spacers at top nesting level");const e=Object(d.a)(this._layoutStack);if(null==e)throw Error("Level is null");e.Boundary.MergeFromNode(t),this.BoundaryChanged&&this.BoundaryChanged(this,new c(e.Boundary,e,this))}PopLayoutLevel(){var t,e;const i=this._layoutStack.pop();if(null==i)throw Error("innerLevel is null");if(this.BoundaryChanged&&this.BoundaryChanged(this,new c(i.Boundary,i,this)),this._layoutStack.length>0){const n=Object(d.a)(this._layoutStack);if(null==n)throw Error("higherLevel is null");switch(this.CurrentOperation){case o.a.VerticalLayout:n.Boundary.VerticalMergeFrom(i.Boundary),n.BranchRoot.State.BranchExterior=n.Boundary.BoundingRect;break;case o.a.HorizontalLayout:if(n.BranchRoot.AssistantsRoot!=i.BranchRoot){const t=n.BranchRoot.State.RequireLayoutStrategy,e=n.Boundary.ComputeOverlap(i.Boundary,t.SiblingSpacing,this.Diagram.LayoutSettings.BranchSpacing);e>0&&(h.a.MoveBranch(this,i,e),this.BoundaryChanged&&this.BoundaryChanged(this,new c(i.Boundary,i,this)))}n.Boundary.MergeFrom(i.Boundary),n.BranchRoot.State.BranchExterior=new a.a(n.Boundary.BoundingRect.Left,null==(t=n.BranchRoot.State.BranchExterior)?void 0:t.Top,n.Boundary.BoundingRect.Size.Width,null==(e=n.BranchRoot.State.BranchExterior)?void 0:e.Size.Height);break;default:throw new Error("This operation can only be invoked when performing vertical or horizontal layouts")}this.BoundaryChanged&&this.BoundaryChanged(this,new c(n.Boundary,n,this))}this._pooledBoundaries.push(i.Boundary)}}},"./lib/core/LayoutStrategyBase.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var o=i("./lib/core/BranchParentAlignment.ts");class n{constructor(){this.ParentAlignment=o.a.InvalidValue,this.ParentChildSpacing=20,this.ParentConnectorShield=50,this.SiblingSpacing=20,this.ChildConnectorHookLength=5}get SupportsAssistants(){return this.GetSupportsAssistants()}}},"./lib/core/LinearLayoutStrategy.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var o=i("./lib/core/Point.ts"),n=i("./lib/core/LayoutStrategyBase.ts"),r=i("./lib/core/Dimensions.ts"),a=i("./lib/core/LayoutAlgorithm.ts"),s=i("./lib/core/Box.ts"),l=i("./lib/core/BranchParentAlignment.ts"),h=i("./lib/core/Rect.ts"),u=i("./lib/core/Edge.ts"),S=i("./lib/core/Connector.ts");class c extends n.a{constructor(){super(...arguments),this.GetSupportsAssistants=()=>!0}PreProcessThisNode(t,e){if(e.ChildCount>0&&(e.State.NumberOfSiblings=e.Element.IsCollapsed?0:e.ChildCount,!e.Element.IsCollapsed)){const t=s.a.Special(s.a.None,e.Element.Id,!1);e.AddRegularChildBox(t);const i=s.a.Special(s.a.None,e.Element.Id,!1);e.AddRegularChildBox(i)}}ApplyVerticalLayout(t,e){let i=e.BranchRoot;if(0==i.Level&&(i.State.SiblingsRowV=new r.a(i.State.Top,i.State.Bottom)),null!=i.AssistantsRoot&&(a.a.CopyExteriorFrom(i.AssistantsRoot.State,i.State),a.a.VerticalLayout(t,i.AssistantsRoot)),0==i.State.NumberOfSiblings)return;let o,n=r.a.MinMax();if(null==i.AssistantsRoot){if(null==i.State.SiblingsRowV)throw Error("SiblingsRowV is null");o=i.State.SiblingsRowV.To+this.ParentChildSpacing}else o=i.State.BranchExterior.Bottom+this.ParentChildSpacing;for(let t=0;t<i.State.NumberOfSiblings;t++){let e=i.Children[t],s=e.State;if(a.a.MoveTo(e.State,0,o),null==e.State.Size)throw Error("Size is null");if(e.State.BranchExterior=h.a.from(e.State.Size,e.State.TopLeft),null==s.Size)throw Error("Size is null");n=r.a.add(n,new r.a(o,o+s.Size.Height))}n=new r.a(n.From,n.To);for(let e=0;e<i.State.NumberOfSiblings;e++){let o=i.Children[e];o.State.SiblingsRowV=n,a.a.VerticalLayout(t,o)}}ApplyHorizontalLayout(t,e){let i=e.BranchRoot;null!=i.AssistantsRoot&&a.a.HorizontalLayout(t,i.AssistantsRoot);for(let e=0;e<i.State.NumberOfSiblings;e++){let o=i.Children[e];a.a.HorizontalLayout(t,o)}if(i.Level>0&&i.ChildCount>0){let o=i.State,n=i.Children[0].State.CenterH,r=i.Children[i.State.NumberOfSiblings-1].State.CenterH,s=1==i.State.NumberOfSiblings||this.ParentAlignment==l.a.Center?n+(r-n)/2:this.ParentAlignment==l.a.Left?n+this.ChildConnectorHookLength:r-this.ChildConnectorHookLength,h=o.CenterH,u=h-s;a.a.MoveChildrenOnly(t,e,u);let S=i.Children[i.State.NumberOfSiblings];if(null==i.Children[0].State.SiblingsRowV)throw Error("SiblingsRowV is null");a.a.AdjustSpacer(S.State,h-this.ParentConnectorShield/2,o.Bottom,this.ParentConnectorShield,i.Children[0].State.SiblingsRowV.From-o.Bottom),t.MergeSpacer(S);let c=i.Children[0].State,d=i.Children[i.State.NumberOfSiblings+1];if(null==c.SiblingsRowV)throw Error("SiblingsRowV is null");a.a.AdjustSpacer(d.State,c.Left,c.SiblingsRowV.From-this.ParentChildSpacing,i.Children[i.State.NumberOfSiblings-1].State.Right-c.Left,this.ParentChildSpacing),t.MergeSpacer(d)}}RouteConnectors(t,e){let i=e.State.NumberOfSiblings,n=0==i?0:1==i?1:2+i;if(0==n)return void(e.State.Connector=null);let r=[],a=e.State,s=a.CenterH;if(null==e.Children)throw new Error("State is present, but children not set");if(1==n)r[0]=new u.a(new o.a(s,a.Bottom),new o.a(s,e.Children[0].State.Top));else{if(null==e.Children[0].State.SiblingsRowV)throw Error("SiblingsRowV is null");let t=e.Children[0].State.SiblingsRowV.From-a.Bottom;r[0]=new u.a(new o.a(s,a.Bottom),new o.a(s,a.Bottom+t-this.ChildConnectorHookLength));for(let t=0;t<i;t++){let i=e.Children[t].State,n=i.CenterH;r[1+t]=new u.a(new o.a(n,i.Top),new o.a(n,i.Top-this.ChildConnectorHookLength))}r[n-1]=new u.a(new o.a(r[1].To.X,r[1].To.Y),new o.a(r[n-2].To.X,r[1].To.Y))}e.State.Connector=new S.a(r)}}},"./lib/core/MultiLineFishboneLayoutStrategy.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return b}));var o=i("./lib/core/LinearLayoutStrategy.ts"),n=i("./lib/core/LayoutStrategyBase.ts"),r=i("./lib/core/Node.ts"),a=i("./lib/core/Box.ts"),s=i("./lib/core/Dimensions.ts"),l=i("./lib/core/LayoutAlgorithm.ts"),h=i("./lib/core/BranchParentAlignment.ts"),u=i("./lib/core/Edge.ts"),S=i("./lib/core/Point.ts"),c=i("./lib/core/Connector.ts"),d=i("./lib/core/Rect.ts");class g{constructor(t,e){this.Group=0,this.FromIndex=0,this.Count=0,this.MaxOnLeft=0,this._numberOfSiblings=t,this._numberOfGroups=e}CountInGroup(){let t=2*this._numberOfGroups,e=0,i=2*this.Group+2,o=0;for(;;){let n=o>=this._numberOfSiblings-t?this._numberOfSiblings-o:t;if(!(n>=i)){i--,n>=i&&e++;break}e+=2,o+=t}return e}NextGroup(){return this.FromIndex=this.FromIndex+this.Count,this.FromIndex>0&&this.Group++,this.Count=this.CountInGroup(),this.MaxOnLeft=Math.floor(this.Count/2)+this.Count%2,0!=this.Count}}class f extends r.a{constructor(t){super(t)}Prepare(t){null==this.Children?this.Children=[]:this.Children.length=0}AddChildView(t){this.Children.push(t)}}class m extends n.a{constructor(t){super(),this.GetSupportsAssistants=()=>!1,this.Iterator=new g(t.State.NumberOfSiblings,t.State.NumberOfSiblingColumns),this.RealRoot=t,this.SpecialRoot=new f(a.a.Special(a.a.None,t.Element.Id,!0)),this.SpecialRoot.Level=this.RealRoot.Level,this.SpecialRoot.ParentNode=this.RealRoot,this.SpecialRoot.State.EffectiveLayoutStrategy=this;let e=t.State.RequireLayoutStrategy;this.SiblingSpacing=e.SiblingSpacing,this.ParentConnectorShield=e.ParentConnectorShield,this.ParentChildSpacing=e.ParentChildSpacing,this.ParentAlignment=e.ParentAlignment,this.ChildConnectorHookLength=e.ChildConnectorHookLength}NextGroup(){if(!this.Iterator.NextGroup())return!1;this.SpecialRoot.State.NumberOfSiblings=this.Iterator.Count,this.SpecialRoot.Prepare(2*this.RealRoot.State.NumberOfSiblingRows);for(let t=0;t<this.Iterator.Count;t++)this.SpecialRoot.AddChildView(this.RealRoot.Children[this.Iterator.FromIndex+t]);let t=this.RealRoot.Children[this.RealRoot.State.NumberOfSiblings+1+this.Iterator.Group];return this.SpecialRoot.AddChildView(t),l.a.CopyExteriorFrom(this.SpecialRoot.State,this.RealRoot.State),!0}PreProcessThisNode(t,e){throw new Error("NotSupportedException")}ApplyVerticalLayout(t,e){var i,o;if(null==this.SpecialRoot.State.SiblingsRowV)throw Error("SiblingsRowV is null");let n=null!=(o=null==(i=this.RealRoot.AssistantsRoot)?void 0:i.State.BranchExterior.Bottom)?o:this.SpecialRoot.State.SiblingsRowV.To;for(let e=0;e<this.Iterator.MaxOnLeft;e++){let i=0==e?this.ParentChildSpacing:this.SiblingSpacing,o=this.SpecialRoot.Children[e],r=o.State;l.a.MoveTo(r,r.Left,n+i);let a=new s.a(r.Top,r.Bottom),h=e+this.Iterator.MaxOnLeft;if(null==r.Size)throw Error("Size is null");if(h<this.Iterator.Count){let e=this.SpecialRoot.Children[h],o=e.State;if(l.a.MoveTo(o,o.Left,n+i),null==o.Size)throw Error("Size is null");o.Bottom>r.Bottom?l.a.MoveTo(r,r.Left,o.CenterV-r.Size.Height/2):o.Bottom<r.Bottom&&l.a.MoveTo(o,o.Left,r.CenterV-o.Size.Height/2),o.BranchExterior=d.a.from(o.Size,o.TopLeft),a=s.a.add(a,new s.a(o.Top,o.Bottom)),o.SiblingsRowV=a,l.a.VerticalLayout(t,e),n=o.BranchExterior.Bottom}r.BranchExterior=d.a.from(r.Size,r.TopLeft),r.SiblingsRowV=a,l.a.VerticalLayout(t,o),n=Math.max(n,r.BranchExterior.Bottom)}}ApplyHorizontalLayout(t,e){if(e.BranchRoot!=this.SpecialRoot)throw new Error("InvalidOperationException: Wrong root node received");let i=!0,o=0;for(let n=0;n<this.Iterator.Count;n++){let r=this.SpecialRoot.Children[n];if(l.a.HorizontalLayout(t,r),++o==this.Iterator.MaxOnLeft&&i){l.a.AlignHorizontalCenters(t,e,this.EnumerateSiblings(0,this.Iterator.MaxOnLeft)),i=!1,o=0;let a=Number.MIN_VALUE;for(let t=0;t<n;t++)a=Math.max(a,this.SpecialRoot.Children[t].State.BranchExterior.Right);a=Math.max(a,r.State.Right);let s=this.SpecialRoot.Children[this.SpecialRoot.State.NumberOfSiblings];if(null==this.SpecialRoot.Children[0].State.SiblingsRowV)throw Error("SiblingsRowV is null");if(null==r.State.SiblingsRowV)throw Error("SiblingsRowV is null");l.a.AdjustSpacer(s.State,a,this.SpecialRoot.Children[0].State.SiblingsRowV.From,this.SiblingSpacing,r.State.SiblingsRowV.To-this.SpecialRoot.Children[0].State.SiblingsRowV.From),e.Boundary.MergeFromNode(s)}}l.a.AlignHorizontalCenters(t,e,this.EnumerateSiblings(this.Iterator.MaxOnLeft,this.Iterator.Count))}EnumerateSiblings(t,e){const i=[];for(let o=t;o<e;o++)i.push(this.SpecialRoot.Children[o]);return i}RouteConnectors(t,e){throw new Error}}class b extends o.a{constructor(){super(...arguments),this.MaxGroups=4,this.GetSupportsAssistants=()=>!0}PreProcessThisNode(t,e){if(this.MaxGroups<=0)throw new Error("MaxGroups must be a positive value");if(e.ChildCount<=2*this.MaxGroups)super.PreProcessThisNode(t,e);else if(e.State.NumberOfSiblings=e.ChildCount,e.State.NumberOfSiblings>0){e.State.NumberOfSiblingColumns=this.MaxGroups,e.State.NumberOfSiblingRows=Math.floor(e.State.NumberOfSiblings/(2*this.MaxGroups)),e.State.NumberOfSiblings%(2*this.MaxGroups)!=0&&e.State.NumberOfSiblingRows++;let t=a.a.Special(a.a.None,e.Element.Id,!1);e.AddRegularChildBox(t);for(let t=0;t<e.State.NumberOfSiblingColumns;t++){let t=a.a.Special(a.a.None,e.Element.Id,!1);e.AddRegularChildBox(t)}if(e.State.NumberOfSiblingColumns>1){let t=a.a.Special(a.a.None,e.Element.Id,!1);e.AddRegularChildBox(t)}}}ApplyVerticalLayout(t,e){let i=e.BranchRoot;if(i.State.NumberOfSiblings<=2*this.MaxGroups)return void super.ApplyVerticalLayout(t,e);0==i.Level&&(i.State.SiblingsRowV=new s.a(i.State.Top,i.State.Bottom)),null!=i.AssistantsRoot&&(l.a.CopyExteriorFrom(i.AssistantsRoot.State,i.State),l.a.VerticalLayout(t,i.AssistantsRoot));let o=new m(i);for(;o.NextGroup();)l.a.VerticalLayout(t,o.SpecialRoot)}ApplyHorizontalLayout(t,e){let i=e.BranchRoot;if(i.State.NumberOfSiblings<=2*this.MaxGroups)return void super.ApplyHorizontalLayout(t,e);0==i.Level&&(i.State.SiblingsRowV=new s.a(i.State.Top,i.State.Bottom)),null!=i.AssistantsRoot&&l.a.HorizontalLayout(t,i.AssistantsRoot);let o=new m(i);for(;o.NextGroup();)l.a.HorizontalLayout(t,o.SpecialRoot);let n=i.State;if(i.Level>0){let o=0;if(i.State.NumberOfSiblingColumns>1){let t=i.Children[i.State.NumberOfSiblings+1].State.CenterH,e=i.Children[i.State.NumberOfSiblings+i.State.NumberOfSiblingColumns].State.CenterH,r=1==i.State.NumberOfSiblings||this.ParentAlignment==h.a.Center?t+(e-t)/2:this.ParentAlignment==h.a.Left?t+this.ChildConnectorHookLength:e-this.ChildConnectorHookLength;o=n.CenterH-r}else{let t=i.Children[1+i.State.NumberOfSiblings].State.CenterH;o=n.CenterH-t}l.a.MoveChildrenOnly(t,e,o)}if(i.Level>0){if(null==i.Children[0].State.SiblingsRowV)throw Error("SiblingsRowV is null");let e=i.State.NumberOfSiblings,o=i.Children[e];if(l.a.AdjustSpacer(o.State,n.CenterH-this.ParentConnectorShield/2,n.Bottom,this.ParentConnectorShield,i.Children[0].State.SiblingsRowV.From-n.Bottom),t.MergeSpacer(o),e++,e+=i.State.NumberOfSiblingColumns,i.State.NumberOfSiblingColumns>1){let o=i.Children[e],n=i.Children[i.State.NumberOfSiblings+1].State.TopLeft,r=i.Children[e-1].State.Right;l.a.AdjustSpacer(o.State,n.X,n.Y-this.ParentChildSpacing,r-n.X,this.ParentChildSpacing),t.MergeSpacer(o)}}}RouteConnectors(t,e){if(e.State.NumberOfSiblings<=2*this.MaxGroups)return void super.RouteConnectors(t,e);e.State.NumberOfSiblings,e.State.NumberOfSiblingColumns;e.State.NumberOfSiblingColumns;let i=[],o=e.State,n=o.CenterH,r=0;if(null==e.Children[0].State.SiblingsRowV)throw Error("SiblingsRowV is null");let a=e.Children[0].State.SiblingsRowV.From-o.Bottom;i[r++]=new u.a(new S.a(n,o.Bottom),new S.a(n,o.Bottom+a-this.ChildConnectorHookLength));let s=new g(e.State.NumberOfSiblings,e.State.NumberOfSiblingColumns);for(;s.NextGroup();){let t=e.Children[1+e.State.NumberOfSiblings+s.Group].State,o=t.CenterH,n=!0,a=0;for(let l=s.FromIndex;l<s.FromIndex+s.Count;l++){let h=n?e.Children[l].State.Right:e.Children[l].State.Left,c=e.Children[l].State.CenterV;i[r++]=new u.a(new S.a(o,c),new S.a(h,c)),++a==s.MaxOnLeft&&(a=0,n&&(i[1+e.State.NumberOfSiblings+s.Group]=new u.a(new S.a(t.CenterH,t.Top-this.ChildConnectorHookLength),new S.a(t.CenterH,e.Children[l].State.CenterV))),n=!n)}}if(r+=e.State.NumberOfSiblingColumns,e.State.NumberOfSiblingColumns>1){let t=e.Children[1+e.State.NumberOfSiblings].State,o=e.Children[1+e.State.NumberOfSiblings+e.State.NumberOfSiblingColumns-1].State;i[r]=new u.a(new S.a(t.CenterH,t.Top-this.ChildConnectorHookLength),new S.a(o.CenterH,o.Top-this.ChildConnectorHookLength))}e.State.Connector=new c.a(i)}}},"./lib/core/MultiLineHangerLayoutStrategy.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return S}));var o=i("./lib/core/LinearLayoutStrategy.ts"),n=i("./lib/core/Box.ts"),r=i("./lib/core/Dimensions.ts"),a=i("./lib/core/LayoutAlgorithm.ts"),s=i("./lib/core/Edge.ts"),l=i("./lib/core/Point.ts"),h=i("./lib/core/Connector.ts"),u=i("./lib/core/Rect.ts");class S extends o.a{constructor(){super(...arguments),this.MaxSiblingsPerRow=4,this.GetSupportsAssistants=()=>!0}PreProcessThisNode(t,e){if(this.MaxSiblingsPerRow<=0||this.MaxSiblingsPerRow%2!=0)throw new Error("MaxSiblingsPerRow must be a positive even value");if(e.ChildCount<=this.MaxSiblingsPerRow)super.PreProcessThisNode(t,e);else if(e.State.NumberOfSiblings=e.ChildCount,e.State.NumberOfSiblings>0){let t=e.ChildCount%this.MaxSiblingsPerRow;e.State.NumberOfSiblingColumns=1+this.MaxSiblingsPerRow,e.State.NumberOfSiblingRows=Math.floor(e.ChildCount/this.MaxSiblingsPerRow),0!=t&&e.State.NumberOfSiblingRows++,e.State.NumberOfSiblings=e.ChildCount+e.State.NumberOfSiblingRows,t>0&&t<=Math.floor(this.MaxSiblingsPerRow/2)&&e.State.NumberOfSiblings--;let i=Math.floor(this.MaxSiblingsPerRow/2);for(;i<e.State.NumberOfSiblings;){let t=n.a.Special(n.a.None,e.Element.Id,!1);e.InsertRegularChildBoxByIndex(i,t),i+=e.State.NumberOfSiblingColumns}let o=n.a.Special(n.a.None,e.Element.Id,!1);e.AddRegularChildBox(o);for(let t=0;t<e.State.NumberOfSiblingRows;t++){let t=n.a.Special(n.a.None,e.Element.Id,!1);e.AddRegularChildBox(t)}}}ApplyVerticalLayout(t,e){let i=e.BranchRoot;if(i.State.NumberOfSiblings<=this.MaxSiblingsPerRow)return void super.ApplyVerticalLayout(t,e);0==i.Level&&(i.State.SiblingsRowV=new r.a(i.State.Top,i.State.Bottom)),null!=i.AssistantsRoot&&(a.a.CopyExteriorFrom(i.AssistantsRoot.State,i.State),a.a.VerticalLayout(t,i.AssistantsRoot));let o=new r.a(i.State.SiblingsRowV.From,null==i.AssistantsRoot?i.State.SiblingsRowV.To:i.State.BranchExterior.Bottom);for(let e=0;e<i.State.NumberOfSiblingRows;e++){let n=r.a.MinMax(),s=0==e?this.ParentChildSpacing:this.SiblingSpacing,l=e*i.State.NumberOfSiblingColumns,h=Math.min(l+i.State.NumberOfSiblingColumns,i.State.NumberOfSiblings);for(let t=l;t<h;t++){let e=i.Children[t];if(e.Element.IsSpecial)continue;let l=e.State,h=o.To+s;a.a.MoveTo(e.State,l.Left,h),e.State.BranchExterior=u.a.from(e.State.Size,e.State.TopLeft),n=r.a.add(n,new r.a(h,h+l.Size.Height))}n=new r.a(n.From,n.To);let S=Number.MIN_VALUE;for(let e=l;e<h;e++){let o=i.Children[e];o.State.SiblingsRowV=n,a.a.VerticalLayout(t,o),S=Math.max(S,o.State.BranchExterior.Bottom)}o=new r.a(n.From,Math.max(S,n.To));let c=l+Math.floor(i.State.NumberOfSiblingColumns/2);if(c<i.State.NumberOfSiblings){let t=e==i.State.NumberOfSiblingRows-1?i.Children[c-1].State.SiblingsRowV.To:o.To,n=i.Children[c].State;a.a.AdjustSpacer(n,0,o.From,this.ParentConnectorShield,t-o.From)}}}ApplyHorizontalLayout(t,e){let i=e.BranchRoot;if(i.State.NumberOfSiblings<=this.MaxSiblingsPerRow)return void super.ApplyHorizontalLayout(t,e);null!=i.AssistantsRoot&&a.a.HorizontalLayout(t,i.AssistantsRoot);for(let o=0;o<i.State.NumberOfSiblingColumns;o++){for(let e=0;e<i.State.NumberOfSiblingRows;e++){let n=e*i.State.NumberOfSiblingColumns+o;if(n>=i.State.NumberOfSiblings)break;let r=i.Children[n];a.a.HorizontalLayout(t,r)}a.a.AlignHorizontalCenters(t,e,this.EnumerateColumn(i,o))}let o=i.State,n=i.Children[Math.floor(i.State.NumberOfSiblingColumns/2)].State.CenterH,r=o.CenterH-n;a.a.MoveChildrenOnly(t,e,r);let s=i.Children[i.State.NumberOfSiblings];a.a.AdjustSpacer(s.State,o.CenterH-this.ParentConnectorShield/2,o.Bottom,this.ParentConnectorShield,i.Children[0].State.SiblingsRowV.From-o.Bottom),t.MergeSpacer(s);let l=this.ParentChildSpacing;for(let e=0;e<i.State.NumberOfSiblings;e+=i.State.NumberOfSiblingColumns){let o=i.Children[e].State,n=i.Children[Math.min(e+i.State.NumberOfSiblingColumns-1,i.State.NumberOfSiblings-1)].State,r=i.Children[1+i.State.NumberOfSiblings+Math.floor(e/i.State.NumberOfSiblingColumns)],h=n.Right>=s.State.Right?n.Right-o.Left:s.State.Right-o.Left;a.a.AdjustSpacer(r.State,o.Left,o.SiblingsRowV.From-l,h,l),t.MergeSpacer(r),l=this.SiblingSpacing}}EnumerateColumn(t,e){const i=[];for(let o=0;o<t.State.NumberOfSiblingRows;o++){let n=o*t.State.NumberOfSiblingColumns+e;if(n>=t.State.NumberOfSiblings)break;i.push(t.Children[n])}return i}RouteConnectors(t,e){if(e.State.NumberOfSiblings<=this.MaxSiblingsPerRow)return void super.RouteConnectors(t,e);let i=1+e.State.NumberOfSiblingRows;for(let t of e.Children)t.Element.IsSpecial||i++;let o=[],n=e.State,r=n.CenterH,a=e.Children[e.State.NumberOfSiblings-1].State.SiblingsRowV.From-this.ChildConnectorHookLength-n.Bottom;o[0]=new s.a(new l.a(r,n.Bottom),new l.a(r,n.Bottom+a));let u=1;for(let t=0;t<e.State.NumberOfSiblings;t++){let i=e.Children[t];if(!i.Element.IsSpecial){let t=i.State,e=t.CenterH;o[u++]=new s.a(new l.a(e,t.Top),new l.a(e,t.Top-this.ChildConnectorHookLength))}}let S=i-e.State.NumberOfSiblingRows-1;for(let t=1;t<i-e.State.NumberOfSiblingRows;t+=this.MaxSiblingsPerRow){let e=o[t],i=o[Math.min(t+this.MaxSiblingsPerRow-1,S)];i.From.X<o[0].From.X?o[u++]=new s.a(new l.a(e.To.X,e.To.Y),new l.a(o[0].To.X,e.To.Y)):o[u++]=new s.a(new l.a(e.To.X,e.To.Y),new l.a(i.To.X,e.To.Y))}e.State.Connector=new h.a(o)}}},"./lib/core/Node.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var o=i("./lib/core/Box.ts"),n=i("./lib/core/Size.ts"),r=i("./lib/core/Point.ts"),a=i("./lib/core/Dimensions.ts"),s=i("./lib/core/Rect.ts");class l{constructor(){this._effectiveLayoutStrategy=null,this.IsHidden=!1,this.Connector=null,this.NumberOfSiblings=0,this.NumberOfSiblingRows=0,this.NumberOfSiblingColumns=0,this.Size=new n.a(0,0),this.TopLeft=new r.a(0,0),this.BranchExterior=new s.a(0,0,0,0),this.SiblingsRowV=new a.a(0,0)}set EffectiveLayoutStrategy(t){this._effectiveLayoutStrategy=t}get RequireLayoutStrategy(){if(null==this._effectiveLayoutStrategy)throw new Error("EffectiveLayoutStrategy is not set");return this._effectiveLayoutStrategy}get Left(){if(null==this.TopLeft)throw Error("TopLeft is null");return this.TopLeft.X}get Right(){if(null==this.TopLeft)throw Error("TopLeft is null");if(null==this.Size)throw Error("Size is null");return this.TopLeft.X+this.Size.Width}get Top(){if(null==this.TopLeft)throw Error("TopLeft is null");if(null==this.Size)throw Error("Size is null");return this.TopLeft.Y}get Bottom(){if(null==this.TopLeft)throw Error("TopLeft is null");if(null==this.Size)throw Error("Size is null");return this.TopLeft.Y+this.Size.Height}get CenterH(){if(null==this.TopLeft)throw Error("TopLeft is null");if(null==this.Size)throw Error("Size is null");return this.TopLeft.X+this.Size.Width/2}get CenterV(){if(null==this.TopLeft)throw Error("TopLeft is null");if(null==this.Size)throw Error("Size is null");return this.TopLeft.Y+this.Size.Height/2}}class h{constructor(t){this.Level=0,this.Children=[],this.AssistantsRoot=null,this.ParentNode=null,this.Element=t,this.State=new l}get ChildCount(){var t;return(null==(t=this.Children)?void 0:t.length)||0}get IsAssistantRoot(){var t;return(null==(t=this.ParentNode)?void 0:t.AssistantsRoot)==this}AddAssistantChild(t){return null==this.AssistantsRoot&&(this.AssistantsRoot=new h(o.a.Special(o.a.None,this.Element.Id,!0)),this.AssistantsRoot.ParentNode=this,this.AssistantsRoot.Level=this.AssistantsRoot.Level+1),this.AssistantsRoot.AddRegularChild(t),this}AddRegularChild(t){return this.InsertRegularChild(this.ChildCount,t)}AddRegularChildBox(t){return this.InsertRegularChildBoxByIndex(this.ChildCount,t)}InsertRegularChildBox(t){return this.InsertRegularChildBoxByIndex(this.ChildCount,t)}InsertRegularChildBoxByIndex(t,e){return this.InsertRegularChild(t,new h(e))}InsertRegularChild(t,e){return null==this.Children&&(this.Children=[]),this.Children.splice(t,0,e),e.ParentNode=this,e.Level=this.Level+1,this}IterateChildFirst(t){if(null!=this.AssistantsRoot&&!this.AssistantsRoot.IterateChildFirst(t))return!1;if(null!=this.Children)for(const e of this.Children)if(!e.IterateChildFirst(t))return!1;return t(this)}IterateParentFirst(t,e){var i;if(!t(this))return e&&e(this),!1;if(null==(i=this.AssistantsRoot)||i.IterateParentFirst(t,e),null!=this.Children)for(const i of this.Children)i.IterateParentFirst(t,e);return e&&e(this),!0}SuppressAssistants(){if(null!=this.AssistantsRoot){for(const t of this.AssistantsRoot.Children)this.AddRegularChild(t);this.AssistantsRoot=null}}}},"./lib/core/Operation.ts":function(t,e,i){"use strict";var o,n;(n=o||(o={}))[n.Idle=0]="Idle",n[n.Preparing=1]="Preparing",n[n.PreprocessVisualTree=2]="PreprocessVisualTree",n[n.VerticalLayout=3]="VerticalLayout",n[n.HorizontalLayout=4]="HorizontalLayout",n[n.ConnectorsLayout=5]="ConnectorsLayout",n[n.Completed=6]="Completed",e.a=o},"./lib/core/Point.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));class o{constructor(t,e){this.X=t,this.Y=e}MoveH(t){return new o(this.X+t,this.Y)}}},"./lib/core/Rect.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i("./lib/core/Point.ts"),n=i("./lib/core/Size.ts");class r{get BottomRight(){return new o.a(this.TopLeft.X+this.Size.Width,this.TopLeft.Y+this.Size.Height)}get Left(){return this.TopLeft.X}get Right(){return this.TopLeft.X+this.Size.Width}get CenterH(){return this.TopLeft.X+this.Size.Width/2}get CenterV(){return this.TopLeft.Y+this.Size.Height/2}get Top(){return this.TopLeft.Y}get Bottom(){return this.TopLeft.Y+this.Size.Height}constructor(t,e,i,r){if(i<0)throw new Error("Width out of range");if(r<0)throw new Error("Height out of range");this.TopLeft=new o.a(t,e),this.Size=new n.a(i,r)}static from(t,e=new o.a(0,0)){return new r(e.X,e.Y,t.Width,t.Height)}static add(t,e){const i=Math.min(t.Left,e.Left),o=Math.min(t.Top,e.Top),n=Math.max(t.Right,e.Right),a=Math.max(t.Bottom,e.Bottom);return new r(i,o,n-i,a-o)}MoveH(t){return r.from(this.Size,new o.a(this.Left+t,this.Top))}}},"./lib/core/SingleColumnLayoutStrategy.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var o=i("./lib/core/LayoutStrategyBase.ts"),n=i("./lib/core/Box.ts"),r=i("./lib/core/Dimensions.ts"),a=i("./lib/core/LayoutAlgorithm.ts"),s=i("./lib/core/BranchParentAlignment.ts"),l=i("./lib/core/Edge.ts"),h=i("./lib/core/Point.ts"),u=i("./lib/core/Connector.ts"),S=i("./lib/core/Rect.ts");class c extends o.a{constructor(){super(...arguments),this.GetSupportsAssistants=()=>!0}PreProcessThisNode(t,e){if(this.ParentAlignment!=s.a.Left&&this.ParentAlignment!=s.a.Right)throw new Error("InvalidOperationException: Unsupported value for ParentAlignment");if(e.State.NumberOfSiblings=e.Element.IsCollapsed?0:e.ChildCount,e.State.NumberOfSiblings>0&&e.Level>0){e.State.NumberOfSiblingColumns=1,e.State.NumberOfSiblingRows=e.ChildCount;let t=n.a.Special(n.a.None,e.Element.Id,!1);e.AddRegularChildBox(t)}}ApplyVerticalLayout(t,e){let i=e.BranchRoot;0==i.Level&&(i.State.SiblingsRowV=new r.a(i.State.Top,i.State.Bottom)),null!=i.AssistantsRoot&&(a.a.CopyExteriorFrom(i.AssistantsRoot.State,i.State),a.a.VerticalLayout(t,i.AssistantsRoot));let o=new r.a(i.State.SiblingsRowV.From,null==i.AssistantsRoot?i.State.SiblingsRowV.To:i.State.BranchExterior.Bottom);for(let e=0;e<i.State.NumberOfSiblings;e++){let n=i.Children[e],s=n.State,l=o.To+(0==e?this.ParentChildSpacing:this.SiblingSpacing);a.a.MoveTo(n.State,s.Left,l),n.State.BranchExterior=S.a.from(n.State.Size,n.State.TopLeft);let h=new r.a(l,l+s.Size.Height);n=i.Children[e],n.State.SiblingsRowV=h,a.a.VerticalLayout(t,n);let u=n.State.BranchExterior.Bottom;o=new r.a(h.From,Math.max(u,h.To))}}ApplyHorizontalLayout(t,e){let i=e.BranchRoot,o=i.State;null!=i.AssistantsRoot&&a.a.HorizontalLayout(t,i.AssistantsRoot);for(let e=0;e<o.NumberOfSiblings;e++){let o=i.Children[e];a.a.HorizontalLayout(t,o)}let n=a.a.AlignHorizontalCenters(t,e,this.EnumerateColumn(i));if(i.Level>0&&i.ChildCount>0){let o,r=i.State;if(this.ParentAlignment==s.a.Left){o=r.CenterH+this.ParentConnectorShield/2-n.From}else{if(this.ParentAlignment!=s.a.Right)throw new Error("InvalidOperationException: Invalid ParentAlignment setting");o=r.CenterH-this.ParentConnectorShield/2-n.To}a.a.MoveChildrenOnly(t,e,o);let l=i.Level>0?i.Children[i.ChildCount-1]:null;if(null!=l){let e=i.State.Bottom,o=i.Children[i.ChildCount-2].State.Bottom;a.a.AdjustSpacer(l.State,r.CenterH-this.ParentConnectorShield/2,e,this.ParentConnectorShield,o-e),t.MergeSpacer(l)}}}EnumerateColumn(t){const e=[];for(let i=0;i<t.State.NumberOfSiblings;i++)e.push(t.Children[i]);return e}RouteConnectors(t,e){if(0==e.ChildCount)return;let i=1+e.State.NumberOfSiblings,o=Array(i),n=e.State,r=n.CenterH,a=e.Children[e.State.NumberOfSiblings-1].State.CenterV-e.State.Bottom;o[0]=new l.a(new h.a(r,n.Bottom),new h.a(r,n.Bottom+a));for(let t=0;t<e.State.NumberOfSiblings;t++){let i=e.Children[t].State,n=this.ParentAlignment==s.a.Left?i.Left:i.Right;o[1+t]=new l.a(new h.a(r,i.CenterV),new h.a(n,i.CenterV))}e.State.Connector=new u.a(o)}}},"./lib/core/Size.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));class o{constructor(t,e){this.Width=t,this.Height=e}}},"./lib/core/StackOrientation.ts":function(t,e,i){"use strict";var o,n;(n=o||(o={}))[n.InvalidValue=0]="InvalidValue",n[n.SingleRowHorizontal=1]="SingleRowHorizontal",n[n.SingleColumnVertical=2]="SingleColumnVertical",e.a=o},"./lib/core/StackingLayoutStrategy.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var o=i("./lib/core/LayoutStrategyBase.ts"),n=i("./lib/core/Dimensions.ts"),r=i("./lib/core/LayoutAlgorithm.ts"),a=i("./lib/core/BranchParentAlignment.ts"),s=i("./lib/core/Size.ts"),l=i("./lib/core/Rect.ts"),h=i("./lib/core/StackOrientation.ts");class u extends o.a{constructor(){super(),this.GetSupportsAssistants=()=>!1,this.Orientation=h.a.SingleRowHorizontal,this.ParentAlignment=a.a.InvalidValue,this.ChildConnectorHookLength=0,this.ParentConnectorShield=0,this.SiblingSpacing=5}PreProcessThisNode(t,e){if(e.State.NumberOfSiblings=e.Element.IsCollapsed?0:e.ChildCount,e.State.NumberOfSiblings>0&&this.Orientation!=h.a.SingleRowHorizontal&&this.Orientation!=h.a.SingleColumnVertical)throw new Error("InvalidOperationException: Unsupported value for orientation: "+this.Orientation)}ApplyVerticalLayout(t,e){let i=e.BranchRoot;if(0==i.Level&&(i.State.SiblingsRowV=new n.a(i.State.Top,i.State.Bottom)),0==i.State.NumberOfSiblings)return;let o=n.a.MinMax();if(this.Orientation==h.a.SingleRowHorizontal){let e=null==i.AssistantsRoot?i.State.SiblingsRowV.To+this.ParentChildSpacing:i.State.BranchExterior.Bottom+this.ParentChildSpacing;for(let t=0;t<i.State.NumberOfSiblings;t++){let a=i.Children[t],s=a.State;r.a.MoveTo(a.State,0,e),a.State.BranchExterior=l.a.from(a.State.Size,a.State.TopLeft),o=n.a.add(o,new n.a(e,e+s.Size.Height))}o=new n.a(o.From,o.To);for(let e=0;e<i.State.NumberOfSiblings;e++){let n=i.Children[e];n.State.SiblingsRowV=o,r.a.VerticalLayout(t,n)}}else if(this.Orientation==h.a.SingleColumnVertical){let e=new n.a(i.State.SiblingsRowV.From,i.State.SiblingsRowV.To);for(let o=0;o<i.State.NumberOfSiblings;o++){let a=i.Children[o],s=a.State,h=e.To+(0==o?this.ParentChildSpacing:this.SiblingSpacing);r.a.MoveTo(a.State,s.Left,h),a.State.BranchExterior=l.a.from(a.State.Size,a.State.TopLeft);let u=new n.a(h,h+s.Size.Height);a=i.Children[o],a.State.SiblingsRowV=u,r.a.VerticalLayout(t,a);let S=a.State.BranchExterior.Bottom;e=new n.a(u.From,Math.max(S,u.To))}}}ApplyHorizontalLayout(t,e){let i=e.BranchRoot;for(let e of i.Children)r.a.HorizontalLayout(t,e);if(i.ChildCount>0)if(this.Orientation==h.a.SingleRowHorizontal){let o=i.Children[i.State.NumberOfSiblings-1].State.Right-i.Children[0].State.Left;i.State.Size=new s.a(Math.max(i.State.Size.Width,o),i.State.Size.Height);let n=(i.Children[0].State.Left+i.Children[i.ChildCount-1].State.Right)/2,a=i.State.CenterH-n;r.a.MoveChildrenOnly(t,e,a)}else if(this.Orientation==h.a.SingleColumnVertical){r.a.AlignHorizontalCenters(t,e,i.Children);let o=i.Children[0].State.CenterH,n=i.State.CenterH-o;r.a.MoveChildrenOnly(t,e,n)}}RouteConnectors(t,e){}}},"./lib/core/Utils.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));const o=t=>t[t.length-1]},"./lib/test/TestDataGen.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i("./lib/core/Size.ts");class n{constructor(t){}Next(t){return Math.floor(Math.random()*t)}}class r{GenerateDataItems(t,e,i){for(let o of this.GenerateRandomDataItems(e,i))t.Items.set(o.Id,o)}GenerateRandomDataItems(t,e){if(t<0)throw new Error("ArgumentOutOfRangeException: "+t+" - Count must be zero or positive");let i=new n(0),o=[];for(let e=0;e<t;e++)o.push({Id:e.toString(),Date1:new Date,ParentId:null,String1:null,String2:null,IsAssistant:!1});let r=1,a=1;for(;r<t;){let e=15+a+i.Next(2*a);for(let n=r;n<r+e&&n<t;n++){let t=r-1-i.Next(a);o[n].ParentId=o[t].Id}r+=e,a=e}for(let t=0;t<o.length/2;t++){let t=i.Next(o.length),e=i.Next(o.length),n=o[t];o[t]=o[e],o[e]=n}if(e>0){let t=Math.min(o.length,Math.round(Math.ceil(o.length*e/100)));for(let e=0;e<t;e++)o[i.Next(o.length)].IsAssistant=!0}return o}static GenerateBoxSizes(t){let e=new n(0);for(let i of t.BoxesById.values())i.IsSpecial||(i.Size=new o.a(50+e.Next(50),50+e.Next(50)))}}},"./lib/test/TestDataSource.ts":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));class o{constructor(){this.Items=new Map,this.GetParentKeyFunc=t=>this.GetParentKey(t),this.GetDataItemFunc=t=>this.GetDataItem(t)}GetParentKey(t){var e;return(null==(e=this.Items.get(t))?void 0:e.ParentId)||null}GetDataItem(t){const e=this.Items.get(t);if(!e)throw Error("Could not find itemId");return e}get AllDataItemIds(){return[...this.Items.keys()].sort()}}},"./spec/spec.ts":function(t,e,i){"use strict";i.r(e);var o=i("./lib/core/Diagram.ts"),n=i("./lib/core/BoxContainer.ts"),r=i("./lib/core/Operation.ts"),a=i("./lib/core/LinearLayoutStrategy.ts"),s=i("./lib/core/StackingLayoutStrategy.ts"),l=i("./lib/core/MultiLineFishboneLayoutStrategy.ts"),h=i("./lib/core/SingleColumnLayoutStrategy.ts"),u=i("./lib/core/BranchParentAlignment.ts"),S=i("./lib/test/TestDataSource.ts"),c=i("./lib/test/TestDataGen.ts"),d=i("./lib/core/StackOrientation.ts"),g=i("./lib/core/LayoutState.ts"),f=i("./lib/core/Size.ts"),m=i("./lib/core/LayoutAlgorithm.ts"),b=i("./lib/core/MultiLineHangerLayoutStrategy.ts"),p=i("./lib/core/FishboneAssistantsLayoutStrategy.ts");class C{constructor(){this.suppressRootBox=!1,this.totalBoxCount=20,this.percentAssistants=10,this.onLayoutStateChanged=(t,e)=>{t.CurrentOperation===r.a.PreprocessVisualTree&&this.renderBoxes()},this.buildChart(!0)}boxClick(t){const e=this.diagram.Boxes.BoxesById.get(t);e.IsCollapsed=!e.IsCollapsed,this.positionBoxes()}buildChart(t){t&&this.initDiagram(),this.positionBoxes()}collapseAllBoxes(t,e){for(const i of t.BoxesByDataId.values())i.IsSpecial||(i.IsCollapsed=e)}generateData(){const t=this.totalBoxCount,e=this.percentAssistants,i=new S.a;if((new c.a).GenerateDataItems(i,t,e),this.suppressRootBox){i.Items.delete("0");for(const t of i.Items.values())"0"===t.ParentId&&(t.ParentId=null)}return i}initDiagram(){$("#myDiagramDiv").html('<div id="myConnectors" class="chartConnectorsPlane"/>');const t=this.generateData();this.dataSource=t;const e=new n.a(t);$("#CollapseAllOnRebuild")[0].checked&&this.collapseAllBoxes(e,!0);const i=this.diagram=new o.a;i.Boxes=e;const r=new a.a;r.ParentAlignment=u.a.Center,i.LayoutSettings.LayoutStrategies.set("linear",r);let S=new b.a;S.ParentAlignment=u.a.Center,S.MaxSiblingsPerRow=2,i.LayoutSettings.LayoutStrategies.set("hanger2",S),S=new b.a,S.ParentAlignment=u.a.Center,S.MaxSiblingsPerRow=4,i.LayoutSettings.LayoutStrategies.set("hanger4",S);let c=new h.a;c.ParentAlignment=u.a.Right,i.LayoutSettings.LayoutStrategies.set("singleColumnRight",c),c=new h.a,c.ParentAlignment=u.a.Left,i.LayoutSettings.LayoutStrategies.set("singleColumnLeft",c);let g=new l.a;g.ParentAlignment=u.a.Center,g.MaxGroups=1,i.LayoutSettings.LayoutStrategies.set("fishbone1",g),g=new l.a,g.ParentAlignment=u.a.Center,g.MaxGroups=2,i.LayoutSettings.LayoutStrategies.set("fishbone2",g);let f=new s.a;f.ParentAlignment=u.a.InvalidValue,f.Orientation=d.a.SingleRowHorizontal,f.ParentChildSpacing=10,i.LayoutSettings.LayoutStrategies.set("hstack",f);let m=new s.a;m.ParentAlignment=u.a.InvalidValue,m.Orientation=d.a.SingleColumnVertical,m.ParentChildSpacing=10,i.LayoutSettings.LayoutStrategies.set("vstack",m),m=new s.a,m.ParentAlignment=u.a.InvalidValue,m.Orientation=d.a.SingleColumnVertical,m.SiblingSpacing=20,i.LayoutSettings.LayoutStrategies.set("vstackMiddle",m),m=new s.a,m.ParentAlignment=u.a.InvalidValue,m.Orientation=d.a.SingleColumnVertical,m.SiblingSpacing=50,i.LayoutSettings.LayoutStrategies.set("vstackTop",m);let C=new p.a;C.ParentAlignment=u.a.Center,i.LayoutSettings.LayoutStrategies.set("assistants",C),i.LayoutSettings.DefaultLayoutStrategyId="fishbone1",i.LayoutSettings.DefaultAssistantLayoutStrategyId="assistants"}getBoxLevel(t,e){let i=0;for(;e.ParentId>0;){const o=t.BoxesById.get(e.ParentId);if(!o)break;e=o,i++}return i}renderBoxes(){let t=this.diagram.Boxes,e=this.dataSource;const i=[],o=[];this.diagram.VisualTree.IterateParentFirst(n=>{let r=n.Element;if(r.IsDataBound){let a=$("#box"+r.Id);if(a.length>0){let t=$("#exp"+r.Id);return n.State.IsHidden?(a.hide(),t.length>0&&t.hide()):(a.show(),t.length>0&&t.show()),!0}if(n.State.IsHidden)return!0;let s=this.getBoxLevel(t,r);e.GetDataItem(r.DataId);const l={1:"chartBoxTop",2:"chartBoxMiddle",3:"chartBoxLower"}[s]||"chartBoxLowest",h={1:"Top",2:"Middle",3:"Lower"}[s]||s,u=document.createElement("div");if(u.className=l,u.id="box"+r.Id,u.style.position="absolute",u.style.width="150px",u.style.height="auto",u.innerText=`${h} - Box #${r.Id}, Data #${r.DataId}, Asst: ${r.IsAssistant}`,u.addEventListener("click",()=>this.boxClick(r.Id)),i.push(u),n.ChildCount>0||null!=n.AssistantsRoot){const t=document.createElement("div");t.id="exp"+r.Id,t.className="expander",t.addEventListener("click",()=>this.boxClick(r.Id)),o.push(t)}r.Size=this.getBoxElementSize(r.Id)}return!0});const n=document.querySelector("#myDiagramDiv");for(const t of o)n.appendChild(t);for(const t of i)n.appendChild(t)}getBranchOptimizerName(t){const e=document.querySelector("input[name='SelectBranchOptimizer']:checked");return(this["branchOptimizer"+(null==e?void 0:e.value)]||this.branchOptimizerAllLinear)(t)}branchOptimizerAllLinear(t){return t.IsAssistantRoot?null:"linear"}branchOptimizerAllHanger2(t){return t.IsAssistantRoot?null:"hanger2"}branchOptimizerAllHanger4(t){return t.IsAssistantRoot?null:"hanger4"}branchOptimizerAllFishbone1(t){return t.IsAssistantRoot?null:"fishbone1"}branchOptimizerAllFishbone2(t){return t.IsAssistantRoot?null:"fishbone2"}branchOptimizerAllSingleColumnLeft(t){return t.IsAssistantRoot?null:"singleColumnRight"}branchOptimizerAllSingleColumnRight(t){return t.IsAssistantRoot?null:"singleColumnLeft"}branchOptimizerStackers(t){return t.IsAssistantRoot?null:0===t.Level?"vstackTop":1===t.Level?"vstackMiddle":"hstack"}branchOptimizerSmart(t){if(t.IsAssistantRoot)return null;let e=t.ChildCount;if(e<=1)return"vstack";let i=0;for(let o=0;o<e;o++)t.Children[o].ChildCount>0&&i++;return i<=1?e<=4?"vstack":e<=8?"fishbone1":"fishbone2":"hanger4"}boxSizeFunc(t){let e=this.diagram.Boxes.BoxesByDataId.get(t).Id;return this.diagram.Boxes.BoxesById.get(e).Size}getBoxElementSize(t){return new f.a(160,50)}positionBoxes(){$("#myConnectors").html("");this.diagram.Boxes,this.dataSource;let t=this.diagram,e=new g.a(t);e.OperationChanged=this.onLayoutStateChanged,e.BoxSizeFunc=t=>this.boxSizeFunc(t),e.LayoutOptimizerFunc=t=>this.getBranchOptimizerName(t),console.log("positionBoxes"),m.a.Apply(e);const i=m.a.ComputeBranchVisualBoundingRect(t.VisualTree),o=document.querySelector("#myDiagramDiv");if(null==o)throw Error("Cannot find #myDiagramDiv");o.style.width=i.Size.Width+"px",o.style.height=i.Size.Height+"px";let n=-i.Left,r=-i.Top;const a=[];t.VisualTree.IterateParentFirst((function(t){if(t.State.IsHidden)return!1;let e=t.Element;if(e.IsDataBound){const i=document.querySelector("#box"+e.Id);if(i){let o=t.State.TopLeft.X+n,a=t.State.TopLeft.Y+r;if(i.style.left=o+"px",i.style.top=a+"px",i.style.width=t.State.Size.Width+"px",i.style.height=t.State.Size.Height+"px",t.ChildCount>0||null!=t.AssistantsRoot){const i=document.querySelector("#exp"+e.Id);i&&(o=t.State.Right+n-15,a=t.State.Bottom+r-15,i.style.left=o+"px",i.style.top=a+"px",e.IsCollapsed?i.innerText="":i.innerText="")}}}if(null!=t.State.Connector)for(let e=0;e<t.State.Connector.Segments.length;e++){let i,o,s,l,h=t.State.Connector.Segments[e];h.From.Y===h.To.Y?(i="chartHLine",l=1,h.From.X<h.To.X?(o=h.From,s=h.To.X-h.From.X):(o=h.To,s=h.From.X-h.To.X)):(i="chartVLine",s=1,h.From.Y<h.To.Y?(o=h.From,l=h.To.Y-h.From.Y):(o=h.To,l=h.From.Y-h.To.Y)),t.IsAssistantRoot&&(i+="Dotted");const u=document.createElement("div");u.className=i,u.style.top=o.Y+r+"px",u.style.left=o.X+n+"px",u.style.width=s+"px",u.style.height=l+"px",a.push(u)}return!0}));const s=document.querySelector("#myConnectors");for(const t of a)s.appendChild(t)}}document.addEventListener("DOMContentLoaded",()=>{if(console.log("loaded!"),window.chartApp)return;const t=window.chartApp=new C;window.changedSuppressRootBox=function(e){t.suppressRootBox=e.checked,t.buildChart(!0)},window.clickCollapseAll=function(e){t.collapseAllBoxes(t.diagram.Boxes,!0),t.buildChart(!1)},window.clickExpandAll=function(e){t.collapseAllBoxes(t.diagram.Boxes,!1),t.buildChart(!1)},window.clickOptimizer=function(e){t.buildChart(!1)},window.clickDataCounts=function(e){let i=e.value;"small"===i?(t.totalBoxCount=20,t.percentAssistants=0):"small-a"===i?(t.totalBoxCount=20,t.percentAssistants=10):"large"===i?(t.totalBoxCount=200,t.percentAssistants=0):"large-a"===i?(t.totalBoxCount=200,t.percentAssistants=10):"huge-a"===i&&(t.totalBoxCount=1e3,t.percentAssistants=5),t.buildChart(!0)}})}});
//# sourceMappingURL=spec.js.map